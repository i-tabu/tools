<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Rotator App</title>
  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
      padding: 2rem;
    }
    .image-area {
      border: 2px dashed #6c757d;
      padding: 1rem;
      border-radius: 12px;
      background: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 400px;
      overflow: hidden;
    }
    canvas {
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>
<body>
  <div class="container text-center">
    <h1 class="mb-4">🖼️ Image Rotator</h1>

    <!-- Upload -->
    <div class="mb-3">
      <input class="form-control" type="file" id="uploadImage" accept="image/*">
    </div>

    <!-- Image Area -->
    <div class="image-area mb-3">
      <canvas id="canvas"></canvas>
    </div>

    <!-- Controls -->
    <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap mb-3">
      <button class="btn btn-outline-primary" id="rotateLeft">⟲ Rotate Left</button>
      <input type="range" id="rotateSlider" min="-180" max="180" value="0" step="1" class="form-range w-50">
      <button class="btn btn-outline-primary" id="rotateRight">⟳ Rotate Right</button>
    </div>

    <!-- Save -->
    <button class="btn btn-success" id="downloadBtn">💾 Save & Download</button>
  </div>

  <script>
    const uploadImage = document.getElementById("uploadImage");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const rotateLeft = document.getElementById("rotateLeft");
    const rotateRight = document.getElementById("rotateRight");
    const rotateSlider = document.getElementById("rotateSlider");
    const downloadBtn = document.getElementById("downloadBtn");

    let img = new Image();
    let angle = 0;

    // Upload image
    uploadImage.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          img = new Image();
          img.onload = () => {
            angle = 0;
            rotateSlider.value = 0;
            drawImage();
          };
          img.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // Draw rotated image
    function drawImage() {
      if (!img.src) return;
      const radians = angle * Math.PI / 180;
      const w = img.width;
      const h = img.height;

      // Calculate new canvas size
      const cos = Math.abs(Math.cos(radians));
      const sin = Math.abs(Math.sin(radians));
      canvas.width = w * cos + h * sin;
      canvas.height = w * sin + h * cos;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(canvas.width / 2, canvas.height / 2);
      ctx.rotate(radians);
      ctx.drawImage(img, -w / 2, -h / 2);
      ctx.restore();
    }

    // Rotate Left
    rotateLeft.addEventListener("click", () => {
      angle -= 90;
      rotateSlider.value = angle;
      drawImage();
    });

    // Rotate Right
    rotateRight.addEventListener("click", () => {
      angle += 90;
      rotateSlider.value = angle;
      drawImage();
    });

    // Slider precise rotation
    rotateSlider.addEventListener("input", (e) => {
      angle = parseInt(e.target.value);
      drawImage();
    });

    // Download rotated image
    downloadBtn.addEventListener("click", () => {
      if (!img.src) return;
      const link = document.createElement("a");
      link.download = "rotated-image.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    });
  </script>
</body>
</html>
